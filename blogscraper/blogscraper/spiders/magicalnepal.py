import scrapy
from blogscraper.items import BlogscraperItem


class AlpineSpider(scrapy.Spider):
    name = "alpine"
    allowed_domains = ["magicalnepal.com"]
    start_urls = ["https://magicalnepal.com/"]
    
    urls = ['https://www.magicalnepal.com/travel-guide/manaslu/best-time-manaslu-circuit-trek/', 'https://www.magicalnepal.com/trip/manaslu-circuit-trek/', 'https://www.magicalnepal.com/trip/island-peak-climbing/', 'https://www.magicalnepal.com/travel-guide/manaslu/telephone-network-internet-coverage-manaslu-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-circuit-trek-difficulty/', 'https://www.magicalnepal.com/travel-guide/manaslu/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-trek-permit/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-circuit-trek-cost/', 'https://www.magicalnepal.com/trip/everest-base-camp-trek/', 'https://www.magicalnepal.com/trip/langtang-valley-trek/', 'https://www.magicalnepal.com/travel-guide/', 'https://www.magicalnepal.com/trip/tamang-heritage-trek/', 'https://www.magicalnepal.com/trip/manaslu-circuit-tsum-valley-trek/', 'https://www.magicalnepal.com/trip/tsum-valley-trek/', 'https://www.magicalnepal.com/trip/everest-base-camp-helicopter-tour/', 'https://www.magicalnepal.com/travel-guide/manaslu/required-transport-manaslu-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/kathmandu/where-to-stay-in-kathmandu/', 'https://www.magicalnepal.com/trip/mardi-himal-base-camp-trek/', 'https://www.magicalnepal.com/trip/10-days-everest-base-camp-trek/', 'https://www.magicalnepal.com/expat-guide/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-trek-food/', 'https://www.magicalnepal.com/trip/7-days-everest-base-camp-trek/', 'https://www.magicalnepal.com/trip/2-night-3-days-pokhara-tour/', 'https://www.magicalnepal.com/trip/8-days-everest-base-camp-trek/', 'https://www.magicalnepal.com/trip/9-days-everest-base-camp-trek/', 'https://www.magicalnepal.com/trip/ghorepani-poonhill-trek/', 'https://www.magicalnepal.com/trip/annapurna-base-camp-trek/', 'https://www.magicalnepal.com/travel-guide/manaslu/accommodation-manaslu-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/langtang/langtang-trek-costs/', 'https://www.magicalnepal.com/travel-guide/kathmandu/how-to-survive-tribhuvan-international-airport-in-kathmandu/', 'https://www.magicalnepal.com/trip/chisapani-nagarkot-hike/', 'https://www.magicalnepal.com/annapurna-region/', 'https://www.magicalnepal.com/travel-guide/everest/kathmandu-to-lukla/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-june/', 'https://www.magicalnepal.com/travel-insurance/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-july/', 'https://www.magicalnepal.com/travel-guide/everest/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-may/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-april/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-march/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-february/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-january/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-trek-packing-list/', 'https://www.magicalnepal.com/trip/tengboche-everest-view-trek/', 'https://www.magicalnepal.com/trip/around-kanchenjunga-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/everest/everest-region-trek-route-alternative-itineraries/', 'https://www.magicalnepal.com/trip/gokyo-chola-pass-everest-base-camp-trek/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-august/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-september/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-october/', 'https://www.magicalnepal.com/trip/annapurna-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-november/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-in-december/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-permit/', 'https://www.magicalnepal.com/trip/2-nights-3-days-chitwan-tour/', 'https://www.magicalnepal.com/trip/3-nights-4-days-chitwan-tour/', 'https://www.magicalnepal.com/everest-region/', 'https://www.magicalnepal.com/trip/great-himalaya-trail/', 'https://www.magicalnepal.com/trip/lobuche-east-peak-climbing/', 'https://www.magicalnepal.com/trip/everest-three-high-pass-trek/', 'https://www.magicalnepal.com/trip/gokyo-lake-trek/', 'https://www.magicalnepal.com/trip/nar-phu-valley-trek/', 'https://www.magicalnepal.com/trip/everest-base-camp-luxury-lodge-trek/', 'https://www.magicalnepal.com/trip/luxury-everest-base-camp-trek-with-helicopter-back-kathmandu/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-altitude/', 'https://www.magicalnepal.com/booking-terms-condition/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-difficulty/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-distance/', 'https://www.magicalnepal.com/travel-guide/everest/best-time-trek-everest-base-camp/', 'https://www.magicalnepal.com/travel-guide/everest/best-time-everest-base-camp-helicopter-tour/', 'https://www.magicalnepal.com/travel-guide/everest/lukla-tenzing-hillary-airport/', 'https://www.magicalnepal.com/trip/gosaikunda-lake-helicopter-tour/', 'https://www.magicalnepal.com/travel-guide/langtang/best-time-for-helambu-trek/', 'https://www.magicalnepal.com/travel-guide/langtang/best-time-for-gosainkunda-trek/', 'https://www.magicalnepal.com/trip/5-nights-6-days-bhutan-tour/', 'https://www.magicalnepal.com/trip/langtang-helicopter-tour/', 'https://www.magicalnepal.com/nepal/', 'https://www.magicalnepal.com/travel-guide/kathmandu/go-kathmandu-pokhara/', 'https://www.magicalnepal.com/trekking-map/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-helicopter-tour-cost/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-cost/', 'https://www.magicalnepal.com/travel-guide/langtang/langtang-trek-report-may-2016/', 'https://www.magicalnepal.com/trip/independent-himalayas-alpine-expeditions/', 'https://www.magicalnepal.com/expat-guide/10-things-to-do-this-weekend-in-kathmandu/', 'https://www.magicalnepal.com/expat-guide/50-things-to-do-in-kathmandu-for-expat/', 'https://www.magicalnepal.com/trip/jiri-to-everest-base-camp-trek/', 'https://www.magicalnepal.com/trip/upper-dolpo-upper-mustang-traverse-trek/', 'https://www.magicalnepal.com/trip/ganesh-himal-base-camp-ruby-valley-trek/', 'https://www.magicalnepal.com/travel-guide/poon-hill/ghorepani-poonhill-trek-accommodation/', 'https://www.magicalnepal.com/travel-guide/kathmandu/top-things-to-do-see-in-kathmandu/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-trek-report-march-2016/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-10-days-itinerary/', 'https://www.magicalnepal.com/expat-guide/recommended-vaccines-migrating-travelling-nepal/', 'https://www.magicalnepal.com/travel-guide/kathmandu/tribhuvan-international-airport-thamel/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-permits/', 'https://www.magicalnepal.com/travel-guide/kathmandu/best-day-hikes-from-kathmandu/', 'https://www.magicalnepal.com/travel-guide/langtang/best-time-to-go-for-langtang-trek/', 'https://www.magicalnepal.com/trip/2-nights-3-days-bhutan-tour/', 'https://www.magicalnepal.com/trekking-map/everest-base-camp-trek-map/', 'https://www.magicalnepal.com/trip/upper-mustang-trek/', 'https://www.magicalnepal.com/expat-guide/27-best-restaurants-and-cafe-in-kathmandu/', 'https://www.magicalnepal.com/travel-guide/langtang/how-to-do-langtang-trek-in-7-days/', 'https://www.magicalnepal.com/travel-guide/everest/how-to-prepare-to-everest-base-camp-for-beginners/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-12-days-itinerary/', 'https://www.magicalnepal.com/expat-guide/list-of-schools-for-expats-children-in-kathmandu/', 'https://www.magicalnepal.com/travel-guide/manaslu/manaslu-vs-annapurna-circuit/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-with-tilicho-lake-itinerary/', 'https://www.magicalnepal.com/travel-guide/upper-dolpo/dolpo-trek-itineraries/', 'https://www.magicalnepal.com/trip/mera-peak-climbing/', 'https://www.magicalnepal.com/trip/mera-peak-and-island-peak-climbing-via-ama-lapcha-pass/', 'https://www.magicalnepal.com/travel-guide/poon-hill/ghorepani-poon-hill-trek-from-pokhara/', 'https://www.magicalnepal.com/travel-guide/poon-hill/ghorepani-poonhill-trek-5-days-itinerary/', 'https://www.magicalnepal.com/travel-guide/poon-hill/altitude-profile-ghorepani-poon-hill-trek/', 'https://www.magicalnepal.com/travel-guide/upper-dolpo/upper-dolpo-trek-cost/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-altitude-profile/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/kanchenjunga-circuit-trek-food/', 'https://www.magicalnepal.com/travel-guide/upper-mustang/upper-mustang-trek-cost/', 'https://www.magicalnepal.com/travel-guide/kathmandu/', 'https://www.magicalnepal.com/trip/lumba-sumba-pass-trek/', 'https://www.magicalnepal.com/trip/upper-dolpo-circuit-trek/', 'https://www.magicalnepal.com/expat-guide/cultural-shock-nepal-expat-tourist/', 'https://www.magicalnepal.com/expat-guide/ultimate-guide-expat-spouse-nepal/', 'https://www.magicalnepal.com/travel-guide/rara-lake/5-things-do-rara-lake/', 'https://www.magicalnepal.com/trip/dhaulagiri-circuit-trek/', 'https://www.magicalnepal.com/trip/baruntse-expedition/', 'https://www.magicalnepal.com/travel-guide/langtang/permits-required-for-a-langtang-trek/', 'https://www.magicalnepal.com/trip/tilicho-lake-and-annapurna-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-difficulty/', 'https://www.magicalnepal.com/trip/tiji-festival-trek/', 'https://www.magicalnepal.com/career/', 'https://www.magicalnepal.com/about-us/', 'https://www.magicalnepal.com/travel-guide/poon-hill/', 'https://www.magicalnepal.com/trip/saribung-peak-expedition/', 'https://www.magicalnepal.com/trip/himlung-himal-expedition/', 'https://www.magicalnepal.com/travel-guide/rara-lake/rara-lake-trek-permit/', 'https://www.magicalnepal.com/trip/sherpani-col-pass-trek/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-weather/', 'https://www.magicalnepal.com/trip/three-pass-three-kunda-ruby-valley-trek/', 'https://www.magicalnepal.com/trip/7-nights-8-days-tibet-tour/', 'https://www.magicalnepal.com/trip/nar-phu-teri-la-upper-mustang-trek/', 'https://www.magicalnepal.com/trip/khopra-ridge-trek/', 'https://www.magicalnepal.com/trip/annapurna-base-camp-helicopter-tour/', 'https://www.magicalnepal.com/travel-guide/rara-lake/', 'https://www.magicalnepal.com/travel-guide/annapurna/', 'https://www.magicalnepal.com/travel-guide/annapurna/annapurna-circuit-trek-cost/', 'https://www.magicalnepal.com/travel-guide/langtang/', 'https://www.magicalnepal.com/travel-guide/annapurna/best-time-annapurna-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/packing-list-kanchenjunga-trekking/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/', 'https://www.magicalnepal.com/travel-guide/langtang/how-to-combine-helambu-gosainkunda-with-langtang-trek/', 'https://www.magicalnepal.com/travel-guide/kathmandu/5-best-short-hikes-around-kathmandu-valley/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/how-to-reach-taplejung-from-kathmandu/', 'https://www.magicalnepal.com/expat-guide/11-things-immediately-arrival-nepal-expat/', 'https://www.magicalnepal.com/expat-guide/culture-cross-cultural-communication-expat-nepal/', 'https://www.magicalnepal.com/expat-guide/nightlife-in-kathmandu-from-expat-perspective/', 'https://www.magicalnepal.com/expat-guide/where-to-find-household-item-in-kathmandu-for-expat/', 'https://www.magicalnepal.com/expat-guide/non-tourist-visa-information-expat-nepal/', 'https://www.magicalnepal.com/expat-guide/common-annoyances-inconveniences-in-nepal/', 'https://www.magicalnepal.com/expat-guide/best-place-to-live-kathmandu-for-expat/', 'https://www.magicalnepal.com/travel-guide/langtang/how-difficult-is-langtang-trek/', 'https://www.magicalnepal.com/travel-guide/everest/everest-base-camp-trek-altitude-sickness/', 'https://www.magicalnepal.com/far-west-region/', 'https://www.magicalnepal.com/bhutan/', 'https://www.magicalnepal.com/tibet/', 'https://www.magicalnepal.com/podcast/', 'https://www.magicalnepal.com/trip/helambu-trek/', 'https://www.magicalnepal.com/trip/gosaikunda-lake-trek/', 'https://www.magicalnepal.com/trip/upper-dolpo-rara-lake-traverse-trek/', 'https://www.magicalnepal.com/trip/lower-dolpo-circuit-trek/', 'https://www.magicalnepal.com/trip/4-nights-5-days-bhutan-tour/', 'https://www.magicalnepal.com/trip/3-nights-4-days-bhutan-tour/', 'https://www.magicalnepal.com/trip/4-nights-5-days-tibet-tour/', 'https://www.magicalnepal.com/trip/6-nights-7-days-bhutan-tour/', 'https://www.magicalnepal.com/travel-guide/upper-mustang/', 'https://www.magicalnepal.com/trip/makalu-base-camp-trek/', 'https://www.magicalnepal.com/trip/jumla-rara-lake-trek/', 'https://www.magicalnepal.com/trip/tashi-lapcha-pass-trek/', 'https://www.magicalnepal.com/trip/humla-limi-valley-trek/', 'https://www.magicalnepal.com/trip/tsho-rolpa-lake-trek/', 'https://www.magicalnepal.com/trip/kanchenjunga-south-base-camp-trek/', 'https://www.magicalnepal.com/trip/kanchenjunga-north-base-camp-trek/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/accommodation-kanchenjunga-circuit-trek/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/cheram-ramche-oktang-south-base-camp-day-trip/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/encounter-dead-snow-leopard-ghunsa/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/cross-landslide-safely-ghunsa-khambachen/', 'https://www.magicalnepal.com/travel-guide/kanchenjunga/kanchenjunga-circuit-north-south-trek-report-may-2016/', 'https://www.magicalnepal.com/travel-guide/langtang/gosainkunda-trek-costs/', 'https://www.magicalnepal.com/travel-guide/rara-lake/go-rara-lake-kathmandu/', 'https://www.magicalnepal.com/travel-guide/rara-lake/food-accommodation-trek/', 'https://www.magicalnepal.com/travel-guide/pokhara/best-short-treks-from-pokhara/', 'https://www.magicalnepal.com/travel-guide/pokhara/best-places-to-visit-in-pokhara/', 'https://www.magicalnepal.com/travel-guide/langtang/what-kind-of-food-is-available-during-the-langtang-trek/', 'https://www.magicalnepal.com/travel-guide/upper-dolpo/', 'https://www.magicalnepal.com/travel-guide/upper-dolpo/dolpo-trek-altitude-profile/', 'https://www.magicalnepal.com/travel-guide/upper-dolpo/permit-required-dolpo-trek/', 'https://www.magicalnepal.com/travel-guide/upper-mustang/best-time-visit-upper-mustang/', 'https://www.magicalnepal.com/travel-guide/upper-mustang/how-to-get-to-upper-mustang/', 'https://www.magicalnepal.com/travel-guide/upper-mustang/upper-mustang-by-motorbike/', 'https://www.magicalnepal.com/trip/putha-hiunchuli-expedition/']




    #article-single__content
    #wp-block-group__inner-container


    def start_requests(self):
        for url in self.urls:
            yield scrapy.Request(url, callback=self.parse, headers={'Referer': 'https://magicalnepal.com/'})

    def parse(self, response):
        item = BlogscraperItem()
        item["url"] = response.url,
        item["title"] = response.css(".article-single__heading::text").get() or response.css(".trip-header__title::text").get()
        content_container = response.css(".article-single__content") or response.css(".wp-block-group__inner-container")

        selected_tags = content_container.css("h1, h2,h3,h4,h5,h6, p, ul li")

        sections = []
        current_section = {"section_header": "", "section_content": []}
        for tag in selected_tags:
            if tag.root.tag in ["h2", "h3","h4"]:
                # Save the previous section if it has a header
                sections.append(current_section)
                current_section = {"section_header": "", "section_content": []}
                # current_section["section_header"] = tag.xpath("string()").get().strip()
                span_text = tag.css("span::text").get()
                current_section["section_header"] = (
                    span_text.strip() if span_text else tag.xpath("string()").get().strip()
                )

            else:
                # Append content to the current section
                text = tag.xpath("string()").get().strip()

                if text:
                    current_section["section_content"].append(text)

        # Append the last section if it has a header
        if current_section["section_content"]:
            sections.append(current_section)

        item["content"] = sections
        return item
